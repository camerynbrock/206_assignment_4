---
title: "ESM 206 Assignment 4"
author: "Cameryn Brock and Allie Hacker"
date: "11/6/2019"
output: html_document
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, message=FALSE, warning=FALSE}

# Attach packages

library(tidyverse)
library(janitor)

# Read in & clean up data

lobster_data <- read_csv("lobster_abundance_sbc_lter.csv", 
                         na = "-99999") %>% 
  clean_names()

# Tidy data by uncounting counts

lobster_tidy <- lobster_data %>% 
  uncount(count)

# Add MPA column to data
lobster_mpa <- lobster_tidy %>% 
  mutate(mpa= ifelse(site %in% c("IVEE", "NAPL"), "MPA", "non-MPA" ))

```
#### Introduction

To be written

#### Data and Methods

To be written

#### Results

##### 1. Changes in annual lobster abundance.

Data on California Spiny Lobster abundance was collected at five LTER sites. Two of the sites, Isla Vista and Naples, were established as Marine Protected Areas (MPAs) in 2012. Lobster abundance increased from 2012 to 2018 at all sampling locations, but the two sites in MPAs had the greatest percent increase in lobster abundance (Lobster abundance in Isla Vista and Naples increased 36-fold and 49-fold, respectively).

```{r Part A: Changes in lobster abundance}
# Part A: Changes in annual lobster abundance by site

#get annual count of lobsters for each site
lobster_abundance <- lobster_tidy %>% 
  count(site, year) %>% 
  mutate(mpa= ifelse(site %in% c("IVEE", "NAPL"), "MPA", "non-MPA" ))

# graph lobster abundance

ggplot(lobster_abundance, 
       aes(x = year, 
           y = n, 
           group = site, 
           color = mpa, 
           size = mpa)
       )+
  geom_line()+
  scale_color_manual(values = c("aquamarine3", "indianred3"))+
  scale_size_manual(values = c(1.2, 0.5))+
  theme_minimal()+
  labs(x= "Year", y = "Lobsters abundance")+
  scale_x_continuous(breaks = seq(2012, 2018, 1), expand = c(0,0))+
  scale_y_continuous(breaks = seq(0, 1010, 200), expand = c(0,100))+
  coord_cartesian(clip = 'off')+
  theme(legend.title = element_blank(),
        legend.background = element_rect(color = "black"),
        legend.position = c(0.2, 0.8),
        plot.margin = unit(c(0.5,2.5,0,0),"cm"))+
  annotate("text", 
           x = 2018.05, 
           y = 946, 
           label = "Isla Vista", 
           size = 3, 
           hjust = 0)+
  annotate("text", 
           x = 2018.05, 
           y = 290, 
           label = "Naples", 
           size = 3, 
           hjust = 0)+
  annotate("text", 
           x = 2018.05, 
           y = 164, 
           label = "Mohawk", 
           size = 3, 
           hjust = 0)+
  annotate("text", 
           x = 2018.05, 
           y = 355, 
           label = "Carpenteria", 
           size = 3, 
           hjust = 0)+
  annotate("text", 
           x = 2018.05, 
           y = 54, 
           label = "Arroyo Quemado", 
           size = 3, 
           hjust = 0)

```

***Figure 1.** California Spiny Lobster abundance in the Santa Barbara Channel from 2012 to 2018. Sites shown in turquoise were established as Marine Protected Areas (MPAs) in 2012.*

##### 2. Shifts in lobster size distributions.

There was a notable increase in lobster size between 2012 and 2018 in sites that were established as MPAs (Isla Vista, Naples). No substantial shifts in lobster size were observed in sites that were not established as MPAs (Arroyo Quemado, Carpinteria, Mohawk).  

```{r Part B: Shifts in lobster size distributions, message = FALSE, warning = FALSE, fig.asp = 7/20}
# Compare lobster size distributions by site for 2012 and 2018

lobster_size_dist <- lobster_tidy %>% 
  select(year, site, size_mm) %>% 
  filter(year %in% c("2012", "2018")) %>% 
  mutate(mpa = ifelse(site %in% c("IVEE", "NAPL"), "MPA", "Non-MPA" ))

library(ggridges)

site_labs <- c("Arroyo Quemado", "Carpinteria", "Isla Vista", "Mohawk", "Naples")
names(site_labs) <- c("AQUE", "CARP", "IVEE", "MOHK", "NAPL")

ggplot(data = lobster_size_dist, aes(x = size_mm,
                                     y = factor(year, level = c('2018', '2012')))) + 
  stat_density_ridges(aes(fill = mpa,
                          alpha = year),
                      color = "white",
                      size = 0.4,
                      quantile_lines = TRUE,
                      quantiles = 2) +
  facet_wrap(~site,
             nrow = 1,
             labeller = labeller(site = site_labs)) +
  scale_x_continuous(breaks = c(50, 75, 100),
                     limits = c(25, 125),
                     expand = c(0, 0)) +
  scale_y_discrete(expand = c(0.04, 0.04)) +
  scale_fill_manual(values = c("aquamarine3", "indianred3")) +
  scale_alpha(guide = "none",
              range = c(0.55, 0.95)) +
  theme_minimal() +
  theme(panel.spacing.x = unit(0.5, "lines"),
        legend.key.size = unit(0.7,"line")) +
  labs(x = "Lobster size (mm)",
       y = element_blank()) +
  theme(legend.title = element_blank(),
        legend.position = c(0, 0.85),
        legend.text = element_text(size = 8),
        panel.grid.minor.x = element_blank())

```

***Figure 2.** California Spiny Lobster size distributions in the Santa Barbara Channel in 2012 and 2018. Sites shown in turquoise were established as Marine Protected Areas (MPAs) in 2012. White lines indicate the median lobster size for each facet.*


```{r, include = FALSE}
# Mean Lobster size at MPA vs. non-MPA

lobster_size_mpa <- lobster_mpa %>% 
  group_by(mpa, year) %>% 
  summarise(mean_size_mm = mean(size_mm, na.rm = TRUE),
            sd_size = sd(size_mm, na.rm = TRUE),
            lobster_number = n())

# t-test for 2012 lobster size MPA vs non-MPA (two-sample, two-sided, unpaired t-test)

mpa_2012_sample <- lobster_mpa %>% 
  filter(mpa == "MPA", year == "2012") %>% 
  pull(size_mm)

non_mpa_2012_sample <- lobster_mpa %>% 
  filter(mpa == "non-MPA", year == "2012") %>% 
  pull(size_mm)

mpa_2012_ttest <- t.test(mpa_2012_sample, non_mpa_2012_sample)

mpa_2012_ttest

# t-test for 2018 lobster size MPA vs non-MPA (two-sample, two-sided, unpaired t-test)

mpa_2018_sample <- lobster_mpa %>% 
  filter(mpa == "MPA", year == "2018") %>% 
  pull(size_mm)

non_mpa_2018_sample <- lobster_mpa %>% 
  filter(mpa == "non-MPA", year == "2018") %>% 
  pull(size_mm)

mpa_2018_ttest <- t.test(mpa_2018_sample, non_mpa_2018_sample)

mpa_2018_ttest

```

Mean lobster size in Marine Protected Areas (mean, sd) and non-Marine Protected Areas (mean, sd) in 2012 differed significantly (p-value =`r round(mpa_2012_ttest$p.value, 4)`)

```{r, include = FALSE}
# Change in size at MPA sites from 2012 to 2018 (two-sample, two-sided, unpaired t-test)

mpa_size_2012_sample <- lobster_mpa %>% 
  filter(mpa == "MPA", year == "2012") %>% 
  pull(size_mm)

mpa_size_2018_sample <- lobster_mpa %>% 
  filter(mpa == "MPA", year == "2018") %>% 
  pull(size_mm)

mpa_size_ttest <- t.test(mpa_size_2012_sample, mpa_size_2018_sample)

mpa_size_ttest


# Change in size at non-MPA sizes from 2012 to 2018 (two-sample, two-sided, paired t-test)

non_mpa_size_2012_sample <- lobster_mpa %>% 
  filter(mpa == "non-MPA", year == "2012") %>% 
  pull(size_mm)

non_mpa_size_2018_sample <- lobster_mpa %>% 
  filter(mpa == "non-MPA", year == "2018") %>% 
  pull(size_mm)

non_mpa_size_ttest <- t.test(non_mpa_size_2012_sample, non_mpa_size_2018_sample)

non_mpa_size_ttest

```

#### Summary

- To be written
- as bullets

#### References 

*Reed D. 2019.* SBC LTER: Reef: Abundance, size and fishing effort for California Spiny Lobster (Panulirus interruptus), ongoing since 2012. Environmental Data Initiative. https://doi.org/10.6073/pasta/a593a675d644fdefb736750b291579a0. Dataset accessed 10/30/2019.

